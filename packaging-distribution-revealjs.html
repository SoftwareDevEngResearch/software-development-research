<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Kyle Niemeyer">
  <meta name="dcterms.date" content="2025-01-29">
  <title>Software Development for Research – Packaging and distributing your Python code</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Packaging and distributing your Python code</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Kyle Niemeyer 
</div>
        <p class="quarto-title-affiliation">
            Oregon State University
          </p>
    </div>
</div>

  <p class="date">2025-01-29</p>
</section>
<section>
<section id="notebook-to-installable-package" class="title-slide slide level1 center">
<h1>Notebook to installable package</h1>

</section>
<section id="hypothetical-workflow-for-a-researcher" class="slide level2 smaller">
<h2>Hypothetical workflow for a researcher</h2>
<ol type="1">
<li class="fragment">Work on idea for paper with collaborators</li>
<li class="fragment">Do exploratory analysis in scripts and Jupyter ecosystem</li>
<li class="fragment">As research progresses, need to write more-complicated functions and workflows</li>
<li class="fragment">Code begins to sprawl across multiple directories</li>
<li class="fragment">Software dependencies begin to become more complicated</li>
<li class="fragment">The code “works on my machine”, but what about your collaborators?</li>
</ol>
<div class="r-fit-text fragment">
<p><strong>People heroically press forward, but this is painful, and not reusable</strong></p>
</div>
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<p>Imagine you start with a Jupyter notebook that looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python fragment number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb1-3"><a></a></span>
<span id="cb1-4"><a></a><span class="co"># Rosenbrock function</span></span>
<span id="cb1-5"><a></a><span class="kw">def</span> rosen(x):</span>
<span id="cb1-6"><a></a>    <span class="co">"""The Rosenbrock function"""</span></span>
<span id="cb1-7"><a></a>    <span class="cf">return</span> <span class="bu">sum</span>(<span class="fl">100.0</span> <span class="op">*</span> (x[<span class="dv">1</span>:] <span class="op">-</span> x[:<span class="op">-</span><span class="dv">1</span>] <span class="op">**</span> <span class="fl">2.0</span>) <span class="op">**</span> <span class="fl">2.0</span> <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> x[:<span class="op">-</span><span class="dv">1</span>]) <span class="op">**</span> <span class="fl">2.0</span>)</span>
<span id="cb1-8"><a></a></span>
<span id="cb1-9"><a></a><span class="kw">def</span> rosen_der(x):</span>
<span id="cb1-10"><a></a>    <span class="co">"""Gradient of the Rosenbrock function"""</span></span>
<span id="cb1-11"><a></a>    xm <span class="op">=</span> x[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-12"><a></a>    xm_m1 <span class="op">=</span> x[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb1-13"><a></a>    xm_p1 <span class="op">=</span> x[<span class="dv">2</span>:]</span>
<span id="cb1-14"><a></a>    der <span class="op">=</span> np.zeros_like(x)</span>
<span id="cb1-15"><a></a>    der[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">200</span> <span class="op">*</span> (xm <span class="op">-</span> xm_m1<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">400</span> <span class="op">*</span> (xm_p1 <span class="op">-</span> xm<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> xm <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> xm)</span>
<span id="cb1-16"><a></a>    der[<span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">400</span> <span class="op">*</span> x[<span class="dv">0</span>] <span class="op">*</span> (x[<span class="dv">1</span>] <span class="op">-</span> x[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> x[<span class="dv">0</span>])</span>
<span id="cb1-17"><a></a>    der[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">200</span> <span class="op">*</span> (x[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> x[<span class="op">-</span><span class="dv">2</span>] <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb1-18"><a></a>    <span class="cf">return</span> der</span>
<span id="cb1-19"><a></a></span>
<span id="cb1-20"><a></a><span class="co"># Minimization of the Rosenbrock function with some initial guess</span></span>
<span id="cb1-21"><a></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb1-22"><a></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>, jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb1-23"><a></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb1-24"><a></a><span class="bu">print</span>(optimized_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step" class="slide level2">
<h2>Reusable science, step by step</h2>
<p>We can convert our notebook code into a simple importable module an and example calling it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="ex">$</span> tree edit-sys-path </span>
<span id="cb2-2"><a></a><span class="ex">edit-sys-path</span></span>
<span id="cb2-3"><a></a><span class="ex">├──</span> code</span>
<span id="cb2-4"><a></a><span class="ex">│&nbsp;&nbsp;</span> └── utils.py</span>
<span id="cb2-5"><a></a><span class="ex">└──</span> example.py</span>
<span id="cb2-6"><a></a></span>
<span id="cb2-7"><a></a><span class="ex">2</span> directories, 2 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step-1" class="slide level2">
<h2>Reusable science, step by step</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="co"># example.py</span></span>
<span id="cb3-2"><a></a><span class="im">import</span> sys</span>
<span id="cb3-3"><a></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-4"><a></a></span>
<span id="cb3-5"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb3-7"><a></a></span>
<span id="cb3-8"><a></a><span class="co"># Make ./code/utils.py visible to sys.path</span></span>
<span id="cb3-9"><a></a><span class="co"># sys.path position 1 should be after cwd and before activated virtual environment</span></span>
<span id="cb3-10"><a></a>sys.path.insert(<span class="dv">1</span>, <span class="bu">str</span>(Path().cwd() <span class="op">/</span> <span class="st">"code"</span>))</span>
<span id="cb3-11"><a></a><span class="im">from</span> utils <span class="im">import</span> rosen, rosen_der</span>
<span id="cb3-12"><a></a></span>
<span id="cb3-13"><a></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb3-14"><a></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>, jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb3-15"><a></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb3-16"><a></a><span class="bu">print</span>(optimized_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step-2" class="slide level2">
<h2>Reusable science, step by step</h2>
<ul>
<li class="fragment">This is <strong>already better</strong> than having everything in a single massive file!</li>
<li class="fragment">However, now things are tied to this relative path on your computer:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python fragment number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># Make ./code/utils.py visible to sys.path</span></span>
<span id="cb4-2"><a></a>sys.path.insert(<span class="dv">1</span>, <span class="bu">str</span>(Path(<span class="va">__file__</span>).parent <span class="op">/</span> <span class="st">"code"</span>))</span>
<span id="cb4-3"><a></a><span class="im">from</span> utils <span class="im">import</span> rosen, rosen_der</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>and are brittle to refactoring and change; plus, not very portable to others.</p>
</div>
<ul>
<li class="fragment">But we can do better!</li>
</ul>
</section></section>
<section>
<section id="fundamentals" class="title-slide slide level1 center">
<h1>Fundamentals</h1>

</section>
<section id="what-is-a-python-package" class="slide level2">
<h2>What is a Python <em>package</em>?</h2>
<div class="fragment">
<p>First, let’s define <strong>module</strong>.</p>
</div>
<div class="fragment">
<p>From <a href="https://docs.python.org/3/glossary.html#term-module" class="uri">https://docs.python.org/3/glossary.html#term-module</a>:</p>
</div>
<dl>
<dt class="fragment"><strong>module</strong></dt>
<dd class="fragment">
An object that serves as an organizational unit of Python code. Modules have a namespace containing arbitrary Python objects. Modules are loaded into Python by the process of <a href="https://docs.python.org/3/glossary.html#term-importing">importing</a>.
</dd>
<dd class="fragment">
<p>See also <a href="https://docs.python.org/3/glossary.html#term-package">package</a>.</p>
</dd>
</dl>
</section>
<section id="what-is-a-python-package-1" class="slide level2 smaller">
<h2>What is a Python <em>package</em>?</h2>
<p>Deconstructing that definition:</p>
<ul>
<li class="fragment">When I write <code>import modulename</code> I am loading a module</li>
<li class="fragment">But we also talk about “importing a package”! This seems to imply a package is a kind of module.</li>
<li class="fragment">The module can contain “arbitrary Python objects”, which could include other modules.</li>
<li class="fragment">It’s almost like we need a special name for a “module that can contain other modules”…</li>
<li class="fragment">When loading a module, its name gets added to the <em>namespace</em>, a collection of currently defined names and objects they reference: <code>numpy.random.default_rng</code></li>
</ul>
</section>
<section id="aside-why-does-python-have-modules" class="slide level2">
<h2>Aside: why does Python have modules?</h2>
<div class="fragment">
<p>Because it’s good for your code to be <em>modular</em>.</p>
</div>

<aside><div>
<p>Source: <a href="https://realpython.com/python-modules-packages/" class="uri">https://realpython.com/python-modules-packages/</a></p>
</div></aside></section>
<section id="where-do-modules-come-from" class="slide level2">
<h2>Where do modules come from?</h2>
<ul>
<li class="fragment">The standard library
<ul>
<li class="fragment">Python code</li>
<li class="fragment">Compiled C code</li>
</ul></li>
<li class="fragment">A local file that ends in `.py (confusingly, also called a “module”)</li>
<li class="fragment">Third-party libraries that you <code>pip install</code> or <code>conda install</code> (i.e., packages)</li>
<li class="fragment">A local package</li>
</ul>
</section>
<section id="what-is-a-python-package-2" class="slide level2">
<h2>What is a Python <em>package</em>?</h2>
<p>We spent all that time defining <strong>module</strong>, now we can define <strong>package</strong>:</p>
<div class="fragment">
<p>From <a href="https://docs.python.org/3/glossary.html#term-package" class="uri">https://docs.python.org/3/glossary.html#term-package</a>:</p>
</div>
<dl>
<dt class="fragment"><strong>package</strong></dt>
<dd class="fragment">
A Python module which can contain submodules or recursively, subpackages.
</dd>
</dl>
</section>
<section id="package-can-have-multiple-meanings" class="slide level2">
<h2>“Package” can have multiple meanings!</h2>
<p><a href="https://packaging.python.org/en/latest/discussions/distribution-package-vs-import-package/">Two main usages</a>:</p>
<ol type="1">
<li class="fragment">import package: the one we talked about, when you write <code>import packagename</code>. We’ll start by making this.</li>
<li class="fragment">distribution package: the actual artifact that gets downloaded off the internet and stored somewhere, like when you run <code>pip install package</code>. We’ll make these too.</li>
</ol>
</section>
<section id="when-should-i-turn-my-code-into-a-package" class="slide level2">
<h2>When should I turn my code into a package?</h2>
<p>Two common cases for research code:</p>
<ol type="1">
<li class="fragment">Code that goes with a research article; mainly used to reproduce the results, AKA a (computational) project or a research compendium.</li>
<li class="fragment">A generalized tool or <strong>library</strong> that other researchers can use</li>
</ol>
<div class="fragment">
<p>Not all packages intended to reproduce a paper’s results need the full infrastructure we will discuss (documentation website, continuous integration, etc.).</p>
</div>
</section></section>
<section>
<section id="packaging-your-code" class="title-slide slide level1 center">
<h1>Packaging your code</h1>

</section>
<section id="next-steps-packaging-your-code" class="slide level2">
<h2>Next steps: packaging your code</h2>
<ul>
<li class="fragment">The goal is for your code to be installable, and distributable.</li>
<li class="fragment">Per the Zen of Python, this should be straightforward, right?</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">$</span> python3 <span class="at">-c</span> <span class="st">'import this'</span> <span class="kw">|</span> <span class="fu">grep</span> obvious</span>
<span id="cb5-2"><a></a><span class="ex">There</span> should be one-- and preferably only one <span class="at">--obvious</span> way to do it.</span>
<span id="cb5-3"><a></a><span class="ex">Although</span> that way may not be obvious at first unless you<span class="st">'re Dutch.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="next-steps-packaging-your-code-1" class="slide level2">
<h2>Next steps: packaging your code</h2>
<p>Unfortunately, not so much. 😔</p>
<div class="fragment">
<p><a href="https://github.com/scientific-python/cookie"><img data-src="./images/python-packaging-options.png" class="img-fluid" style="width:60.0%" alt="List of Python packaging options"></a></p>
</div>
<div class="fragment">
<p>You might be asking: Why is there more than one thing?</p>
</div>
</section>
<section id="next-steps-packaging-your-code-2" class="slide level2 smaller">
<h2>Next steps: packaging your code</h2>
<p>The <span style="color:blue;">good news</span>: Python packaging has improved dramatically in the last 5 years</p>
<ul>
<li class="fragment">It has never been easier to just point your package manager to some code locally, or on the internet, and get working Python code installed and running on your machine regardless of operating system or architecture</li>
<li class="fragment">This is a small miracle!</li>
</ul>
<div class="fragment">
<p>The <span style="color:red;">bad news</span>: Python packaging has expanded dramatically in the last 5 years</p>
</div>
<div class="fragment">
<ul>
<li class="fragment">By creating standards the PyPA allowed for an ecosystem of packaging backends to be created to tackle various problems (this is good!)</li>
<li class="fragment">This means that our The Zen of Python expectations are violated and we need to make design choices (hard for beginners)</li>
</ul>
</div>
</section>
<section id="next-steps-packaging-your-code-3" class="slide level2">
<h2>Next steps: packaging your code</h2>
<p>The <span style="color:green;">okay news</span>: You can probably default to the simplest thing.</p>
<ul>
<li class="fragment">pure Python: Probably <code>hatch</code></li>
<li class="fragment">compiled extensions: Probably <a href="https://pybind11.readthedocs.io/"><code>setuptools</code> + <code>pybind11</code></a> or <a href="https://scikit-build-core.readthedocs.io/"><code>scikit-build-core</code></a> + <a href="https://github.com/pybind/pybind11"><code>pybind11</code></a></li>
</ul>
<div class="columns">
<div class="fragment column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/"><img data-src="./images/python-packaging-guide.png" class="img-fluid" alt="Python Packaging User Guide, Packaging Python Projects Tutorial"></a></p>
<figcaption>Python Packaging User Guide, Packaging Python Projects Tutorial</figcaption>
</figure>
</div>
</div><div class="fragment column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="https://learn.scientific-python.org/development/guides/packaging-simple/"><img data-src="./images/scientific-python-guide.png" class="img-fluid" alt="Scientific Python Library Development Guide"></a></p>
<figcaption>Scientific Python Library Development Guide</figcaption>
</figure>
</div>
</div></div>
</section>
<section id="simple-packaging-example" class="slide level2">
<h2>Simple packaging example</h2>
<p>Modern <a href="https://peps.python.org/pep-0518/">PEP 518</a> compliant build backends just need a single file: <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/"><code>pyproject.toml</code></a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a></a><span class="ex">$</span> tree simple_packaging</span>
<span id="cb6-2"><a></a><span class="ex">simple-packaging</span></span>
<span id="cb6-3"><a></a><span class="ex">├──</span> LICENSE</span>
<span id="cb6-4"><a></a><span class="ex">├──</span> README.md</span>
<span id="cb6-5"><a></a><span class="ex">├──</span> pyproject.toml</span>
<span id="cb6-6"><a></a><span class="ex">├──</span> src</span>
<span id="cb6-7"><a></a><span class="ex">│&nbsp;&nbsp;</span> └── rosen</span>
<span id="cb6-8"><a></a><span class="ex">│&nbsp;&nbsp;</span>     ├── __init__.py</span>
<span id="cb6-9"><a></a><span class="ex">│&nbsp;&nbsp;</span>     ├── _version.py</span>
<span id="cb6-10"><a></a><span class="ex">│&nbsp;&nbsp;</span>     └── example.py</span>
<span id="cb6-11"><a></a><span class="ex">└──</span> tests</span>
<span id="cb6-12"><a></a>    <span class="ex">└──</span> test_example.py</span>
<span id="cb6-13"><a></a></span>
<span id="cb6-14"><a></a><span class="ex">4</span> directories, 7 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml" class="slide level2 smaller">
<h2>Simple packaging example: <code>pyproject.toml</code></h2>
<p>What is <code>.toml?</code></p>
<blockquote>
<p>“TOML aims to be a minimal configuration file format that’s easy to read due to obvious semantics. TOML is designed to map unambiguously to a hash table. TOML should be easy to parse into data structures in a wide variety of languages.” — <a href="https://toml.io/">https://toml.io/</a> (emphasis mine)</p>
</blockquote>
<p>In recent years TOML has seen a rise in popularity for configuration files and lock files. Things that need to be easy to read (humans) and easy to parse (machines).</p>
</section>
<section id="simple-packaging-example-pyproject.toml-1" class="slide level2">
<h2>Simple packaging example: <code>pyproject.toml</code></h2>
<p>Defining how your project should get <strong>built</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource toml fragment number-lines code-with-copy"><code class="sourceCode toml"><span id="cb7-1"><a></a><span class="kw">[build-system]</span></span>
<span id="cb7-2"><a></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb7-3"><a></a>    <span class="st">"hatchling&gt;=1.13.0"</span><span class="op">,</span></span>
<span id="cb7-4"><a></a>    <span class="st">"hatch-vcs&gt;=0.3.0"</span><span class="op">,</span></span>
<span id="cb7-5"><a></a><span class="op">]</span></span>
<span id="cb7-6"><a></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span>
<span id="cb7-7"><a></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml-2" class="slide level2">
<h2>Simple packaging example: <code>pyproject.toml</code></h2>
<p>Defining project <strong>metadata</strong> and <strong>requirements</strong>/<strong>dependencies</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource toml fragment number-lines code-with-copy"><code class="sourceCode toml"><span id="cb8-1"><a></a><span class="kw">[project]</span></span>
<span id="cb8-2"><a></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"rosen"</span></span>
<span id="cb8-3"><a></a><span class="dt">dynamic</span> <span class="op">=</span> <span class="op">[</span><span class="st">"version"</span><span class="op">]</span></span>
<span id="cb8-4"><a></a><span class="dt">description</span> <span class="op">=</span> <span class="st">"Example package for demonstration"</span></span>
<span id="cb8-5"><a></a><span class="dt">readme</span> <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb8-6"><a></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{ </span><span class="dt">text</span><span class="op"> =</span> <span class="st">"BSD-3-Clause"</span><span class="op"> }</span>  <span class="co"># SPDX short identifier</span></span>
<span id="cb8-7"><a></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-8"><a></a>  <span class="op">{ </span><span class="dt">name</span><span class="op"> =</span> <span class="st">"Kyle Niemeyer"</span><span class="op">, </span><span class="dt">email</span><span class="op"> =</span> <span class="st">"kyle.niemeyer@oregonstate.edu"</span><span class="op"> },</span></span>
<span id="cb8-9"><a></a><span class="op">]</span></span>
<span id="cb8-10"><a></a><span class="dt">requires-python</span> <span class="op">=</span> <span class="st">"&gt;=3.8"</span></span>
<span id="cb8-11"><a></a></span>
<span id="cb8-12"><a></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-13"><a></a>    <span class="st">"scipy&gt;=1.6.0"</span><span class="op">,</span></span>
<span id="cb8-14"><a></a>    <span class="st">"numpy"</span><span class="op">,</span>  <span class="co"># compatible versions controlled through scipy</span></span>
<span id="cb8-15"><a></a><span class="op">]</span></span>
<span id="cb8-16"><a></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml-3" class="slide level2">
<h2>Simple packaging example: <code>pyproject.toml</code></h2>
<p>Configuring <strong>tooling options</strong> and <strong>interactions</strong> with other tools:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource toml fragment number-lines code-with-copy"><code class="sourceCode toml"><span id="cb9-1"><a></a><span class="kw">[tool.hatch.version]</span></span>
<span id="cb9-2"><a></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"vcs"</span></span>
<span id="cb9-3"><a></a></span>
<span id="cb9-4"><a></a><span class="kw">[tool.hatch.version.raw-options]</span></span>
<span id="cb9-5"><a></a><span class="dt">local_scheme</span> <span class="op">=</span> <span class="st">"no-local-version"</span></span>
<span id="cb9-6"><a></a><span class="co"># Need to give root as we aren't at the same level as the git repo</span></span>
<span id="cb9-7"><a></a><span class="dt">root</span> <span class="op">=</span> <span class="st">".."</span></span>
<span id="cb9-8"><a></a></span>
<span id="cb9-9"><a></a><span class="kw">[tool.hatch.build.hooks.vcs]</span></span>
<span id="cb9-10"><a></a><span class="dt">version-file</span> <span class="op">=</span> <span class="st">"src/rosen/_version.py"</span></span>
<span id="cb9-11"><a></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-installing-your-code" class="slide level2 smaller">
<h2>Simple packaging example: Installing your code</h2>
<p>You can now locally install your package into your Python virtual environment!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">$</span> cd simple_packaging</span>
<span id="cb10-2"><a></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> pip wheel</span>
<span id="cb10-3"><a></a><span class="ex">$</span> pip install .</span>
<span id="cb10-4"><a></a><span class="ex">Successfully</span> built rosen</span>
<span id="cb10-5"><a></a><span class="ex">Installing</span> collected packages: rosen</span>
<span id="cb10-6"><a></a><span class="ex">Successfully</span> installed rosen-0.0.2.dev1</span>
<span id="cb10-7"><a></a><span class="ex">$</span> pip show rosen</span>
<span id="cb10-8"><a></a><span class="ex">Name:</span> rosen</span>
<span id="cb10-9"><a></a><span class="ex">Version:</span> 0.0.2.dev1</span>
<span id="cb10-10"><a></a><span class="ex">Summary:</span> Example package for demonstration</span>
<span id="cb10-11"><a></a><span class="ex">Home-page:</span> https://github.com/SoftwareDevEngResearch/packaging-examples</span>
<span id="cb10-12"><a></a><span class="ex">Author:</span> </span>
<span id="cb10-13"><a></a><span class="ex">Author-email:</span> Kyle Niemeyer <span class="op">&lt;</span>kyle.niemeyer@oregonstate.edu<span class="op">&gt;</span></span>
<span id="cb10-14"><a></a><span class="ex">License:</span> BSD-3-Clause</span>
<span id="cb10-15"><a></a><span class="ex">Location:</span> <span class="pp">***</span>/.venv/lib/python3.13/site-packages</span>
<span id="cb10-16"><a></a><span class="ex">Requires:</span> numpy, scipy</span>
<span id="cb10-17"><a></a><span class="ex">Required-by:</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-installing-your-code-1" class="slide level2">
<h2>Simple packaging example: Installing your code</h2>
<p>and use it anywhere</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="co"># example.py</span></span>
<span id="cb11-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-3"><a></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb11-4"><a></a></span>
<span id="cb11-5"><a></a><span class="co"># We can now import our code</span></span>
<span id="cb11-6"><a></a><span class="im">from</span> rosen.example <span class="im">import</span> rosen, rosen_der</span>
<span id="cb11-7"><a></a></span>
<span id="cb11-8"><a></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb11-9"><a></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>,</span>
<span id="cb11-10"><a></a>                  jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb11-11"><a></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb11-12"><a></a><span class="co"># array([1.00000004, 1.0000001 , 1.00000021, 1.00000044, 1.00000092])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-doesnt-slow-down-development" class="slide level2">
<h2>Packaging doesn’t slow down development</h2>
<p><a href="https://peps.python.org/pep-0518/">PEP 518</a> compliant build backends allow for “<a href="https://pip.pypa.io/en/latest/topics/local-project-installs/#editable-installs">editable installs</a>”</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a></a><span class="ex">$</span> python <span class="at">-m</span> pip install <span class="at">--upgrade</span> <span class="at">--editable</span> .</span>
<span id="cb12-2"><a></a><span class="ex">$</span> python <span class="at">-m</span> pip show rosen <span class="kw">|</span> <span class="fu">grep</span> <span class="at">--ignore-case</span> <span class="st">'location'</span></span>
<span id="cb12-3"><a></a><span class="ex">Location:</span> <span class="pp">***</span>/lib/python3.12/site-packages</span>
<span id="cb12-4"><a></a><span class="ex">Editable</span> project location: <span class="pp">***</span>/examples/simple_packaging</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Editable installs add the files in the development directory to Python’s import path. (Only need to re-installation if you change the project metadata.)</p>
</div>
<div class="fragment">
<p>Can <strong>develop</strong> your code under <code>src/</code> and have <strong>immediate</strong> access to it.</p>
</div>
</section>
<section id="packaging-compiled-extensions" class="slide level2">
<h2>Packaging compiled extensions</h2>
<p>With modern packaging infrastructure, packaging compiled extensions requires small extra work!</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a></a><span class="ex">$</span> tree compiled_packaging</span>
<span id="cb13-2"><a></a><span class="ex">compiled-packaging</span></span>
<span id="cb13-3"><a></a><span class="ex">├──</span> CMakeLists.txt</span>
<span id="cb13-4"><a></a><span class="ex">├──</span> LICENSE</span>
<span id="cb13-5"><a></a><span class="ex">├──</span> README.md</span>
<span id="cb13-6"><a></a><span class="ex">├──</span> pyproject.toml</span>
<span id="cb13-7"><a></a><span class="ex">├──</span> src</span>
<span id="cb13-8"><a></a><span class="ex">│&nbsp;&nbsp;</span> ├── basic_math.cpp</span>
<span id="cb13-9"><a></a><span class="ex">│&nbsp;&nbsp;</span> └── rosen_cpp</span>
<span id="cb13-10"><a></a><span class="ex">│&nbsp;&nbsp;</span>     ├── __init__.py</span>
<span id="cb13-11"><a></a><span class="ex">│&nbsp;&nbsp;</span>     └── example.py</span>
<span id="cb13-12"><a></a><span class="ex">└──</span> tests</span>
<span id="cb13-13"><a></a>    <span class="ex">└──</span> test_example.py</span>
<span id="cb13-14"><a></a></span>
<span id="cb13-15"><a></a><span class="ex">4</span> directories, 8 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-1" class="slide level2">
<h2>Packaging compiled extensions</h2>
<p>In <code>pyproject.toml</code>:</p>
<p>Swap build system to <a href="https://scikit-build-core.readthedocs.io/"><code>scikit-build-core</code></a> + <a href="https://github.com/pybind/pybind11"><code>pybind11</code></a></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource toml fragment number-lines code-with-copy"><code class="sourceCode toml"><span id="cb14-1"><a></a><span class="kw">[build-system]</span></span>
<span id="cb14-2"><a></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb14-3"><a></a>  <span class="st">"scikit-build-core"</span><span class="op">,</span></span>
<span id="cb14-4"><a></a>  <span class="st">"pybind11"</span></span>
<span id="cb14-5"><a></a>  <span class="op">]</span></span>
<span id="cb14-6"><a></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"scikit_build_core.build"</span></span>
<span id="cb14-7"><a></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-2" class="slide level2">
<h2>Packaging compiled extensions</h2>
<p><a href="https://cliutils.gitlab.io/modern-cmake/"><code>CMakeLists.txt</code></a>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource cmake fragment number-lines code-with-copy"><code class="sourceCode cmake"><span id="cb15-1"><a></a><span class="co"># Specify CMake version and project language</span></span>
<span id="cb15-2"><a></a><span class="kw">cmake_minimum_required</span>(<span class="ot">VERSION</span> <span class="dt">3.15</span>...<span class="dt">3.30</span>)</span>
<span id="cb15-3"><a></a><span class="kw">project</span>(<span class="dv">${SKBUILD_PROJECT_NAME}</span> <span class="ot">LANGUAGES</span> <span class="ot">CXX</span>)</span>
<span id="cb15-4"><a></a></span>
<span id="cb15-5"><a></a><span class="co"># Setup pybind11</span></span>
<span id="cb15-6"><a></a><span class="kw">set</span>(PYBIND11_FINDPYTHON <span class="ot">ON</span>)</span>
<span id="cb15-7"><a></a><span class="kw">find_package</span>(pybind11 <span class="ot">CONFIG</span> <span class="ot">REQUIRED</span>)</span>
<span id="cb15-8"><a></a></span>
<span id="cb15-9"><a></a><span class="co"># Add the pybind11 module to build targets</span></span>
<span id="cb15-10"><a></a><span class="fu">pybind11_add_module</span>(basic_math MODULE src/basic_math.cpp)</span>
<span id="cb15-11"><a></a><span class="kw">install</span>(<span class="ot">TARGETS</span> <span class="bn">basic_math</span> <span class="ot">DESTINATION</span> <span class="dv">${SKBUILD_PROJECT_NAME}</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-3" class="slide level2">
<h2>Packaging compiled extensions</h2>
<p><code>src/basic_math.cpp</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource cpp fragment number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><a></a><span class="pp">#include </span><span class="im">&lt;pybind11/pybind11.h&gt;</span></span>
<span id="cb16-2"><a></a></span>
<span id="cb16-3"><a></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> j<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">+</span> j<span class="op">;</span> <span class="op">}</span></span>
<span id="cb16-4"><a></a></span>
<span id="cb16-5"><a></a><span class="kw">namespace</span> py <span class="op">=</span> pybind11<span class="op">;</span></span>
<span id="cb16-6"><a></a></span>
<span id="cb16-7"><a></a>PYBIND11_MODULE<span class="op">(</span>basic_math<span class="op">,</span> m<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-8"><a></a>  m<span class="op">.</span>def<span class="op">(</span><span class="st">"add"</span><span class="op">,</span> <span class="op">&amp;</span>add<span class="op">,</span> <span class="st">R"pbdoc(</span></span>
<span id="cb16-9"><a></a><span class="vs">      Add two numbers</span></span>
<span id="cb16-10"><a></a><span class="vs">  </span><span class="st">)pbdoc"</span><span class="op">);</span></span>
<span id="cb16-11"><a></a><span class="op">...</span></span>
<span id="cb16-12"><a></a></span>
<span id="cb16-13"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-installing" class="slide level2">
<h2>Packaging compiled extensions: Installing</h2>
<p>Installing locally is the same as for the pure-Python example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a></a><span class="ex">$</span> cd simple_packaging</span>
<span id="cb17-2"><a></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> pip wheel</span>
<span id="cb17-3"><a></a><span class="ex">$</span> pip install .</span>
<span id="cb17-4"><a></a><span class="ex">Successfully</span> built rosen-cpp</span>
<span id="cb17-5"><a></a><span class="ex">Installing</span> collected packages: rosen-cpp</span>
<span id="cb17-6"><a></a><span class="ex">Successfully</span> installed rosen-cpp-0.0.1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Module name is that given in C++:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python fragment number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="im">from</span> rosen_cpp <span class="im">import</span> basic_math</span>
<span id="cb18-2"><a></a>basic_math.add(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb18-3"><a></a><span class="co"># 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="distributing-packages" class="title-slide slide level1 center">
<h1>Distributing packages</h1>

</section>
<section id="going-further-distributing-packages" class="slide level2 smaller">
<h2>Going further: Distributing packages</h2>
<p>If your code is publicly available on the WWW in a Git repository, you’ve already done a version of distribution!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a></a><span class="co"># pip install "git+https://example.com/repo/project.git@branch#subdirectory=path"</span></span>
<span id="cb19-2"><a></a><span class="ex">$</span> pip install <span class="dt">\</span></span>
<span id="cb19-3"><a></a>  <span class="st">"git+https://github.com/SoftwareDevEngResearch/packaging-examples.git#subdirectory=simple_packaging"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a></a><span class="co"># Works for pure-Python packages</span></span>
<span id="cb20-2"><a></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> <span class="st">"git+https://github.com/scikit-hep/pyhf.git"</span></span>
<span id="cb20-3"><a></a><span class="co"># as well as packages with compiled extensions</span></span>
<span id="cb20-4"><a></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> <span class="st">"git+https://github.com/scikit-hep/iminuit.git"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-further-distributing-packages-1" class="slide level2">
<h2>Going further: Distributing packages</h2>
<p>Ideally, we’d prefer a more organized approach: distribution through a <strong>package index</strong>.</p>
<div class="fragment">
<p>First, we need to create <strong>distributions</strong> of our packaged code.</p>
</div>
<div class="fragment">
<p>Distributions that <code>pip</code> can install:</p>
<ul>
<li class="fragment"><a href="https://packaging.python.org/en/latest/glossary/#term-Source-Distribution-or-sdist">source distribution (sdist)</a>: A tarfile (<code>.tar.gz</code>) of the source files of our package (subset of all the files in the repository)</li>
<li class="fragment"><a href="https://packaging.python.org/en/latest/glossary/#term-Built-Distribution">wheel</a>: A zipfile (<code>.whl</code>) of the file system structure and package metadata with any dependencies prebuilt. No arbitrary code execution, only decompressing and copying of files</li>
</ul>
</div>
</section>
<section id="going-further-distributing-packages-2" class="slide level2">
<h2>Going further: Distributing packages</h2>
<p>To create these <strong>distributions</strong> from source code, rely on our package <strong>build backend</strong> (e.g., <a href="https://hatch.pypa.io/"><code>hatchling</code></a>) and <strong>build frontend</strong> tool like <a href="https://pypa-build.readthedocs.io/en/stable/"><code>build</code></a></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> build</span>
<span id="cb21-2"><a></a><span class="ex">$</span> python <span class="at">-m</span> build .</span>
<span id="cb21-3"><a></a><span class="ex">*</span> Creating venv isolated environment...</span>
<span id="cb21-4"><a></a><span class="ex">*</span> Installing packages in isolated environment... <span class="er">(</span><span class="ex">hatch-vcs</span><span class="op">&gt;</span>=0.3.0, hatchling<span class="op">&gt;</span>=1.13.0<span class="kw">)</span></span>
<span id="cb21-5"><a></a><span class="ex">*</span> Getting build dependencies for sdist...</span>
<span id="cb21-6"><a></a><span class="ex">*</span> Building sdist...</span>
<span id="cb21-7"><a></a><span class="ex">*</span> Building wheel from sdist</span>
<span id="cb21-8"><a></a><span class="ex">*</span> Creating venv isolated environment...</span>
<span id="cb21-9"><a></a><span class="ex">*</span> Installing packages in isolated environment... <span class="er">(</span><span class="ex">hatch-vcs</span><span class="op">&gt;</span>=0.3.0, hatchling<span class="op">&gt;</span>=1.13.0<span class="kw">)</span></span>
<span id="cb21-10"><a></a><span class="ex">*</span> Getting build dependencies for wheel...</span>
<span id="cb21-11"><a></a><span class="ex">*</span> Building wheel...</span>
<span id="cb21-12"><a></a><span class="ex">Successfully</span> built rosen-0.0.1.tar.gz and rosen-0.0.1-py3-none-any.whl</span>
<span id="cb21-13"><a></a><span class="ex">$</span> ls dist</span>
<span id="cb21-14"><a></a><span class="ex">rosen-0.0.1-py3-none-any.whl</span>  rosen-0.0.1.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-further-distributing-packages-3" class="slide level2">
<h2>Going further: Distributing packages</h2>
<p>We can now securely upload the distributions under <code>./dist/</code> to any package index that understands how to use them.</p>
<div class="fragment">
<p>The most common is the <a href="https://pypi.org">Python Package Index (PyPI)</a>, which serves as the default package index for <code>pip</code>.</p>
<p><a href="https://pypi.org/"><img data-src="./images/pypi-page.png" class="img-fluid" style="width:50.0%" alt="PyPI landing page"></a></p>
</div>
</section>
<section id="distributing-packages-conda-forge" class="slide level2">
<h2>Distributing packages: <a href="https://conda-forge.org/">conda-forge</a></h2>
<p>The conda family of package managers (<a href="https://docs.conda.io/"><code>conda</code></a>, <a href="https://mamba.readthedocs.io/"><code>mamba</code></a>, <a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html"><code>micromamba</code></a>, <a href="https://prefix.dev/docs/pixi/overview"><code>pixi</code></a>) take an alternative approach from <code>pip</code>.</p>
<div class="fragment">
<p>Instead of installing Python packages, they act as general purpose package managers and install <strong>all dependencies</strong> (including Python) as OS and architecture specific <strong>built binaries</strong> (.<code>conda</code> files — <code>zip</code>file containing compressed <code>tar</code> files) hosted on conda-forge.</p>
</div>
<div class="fragment">
<p>This allows an additional level of runtime environment specification not possible with just <code>pip</code>, though getting environment solves right can become more complicated.</p>
</div>
</section>
<section id="distributing-packages-conda-forge-1" class="slide level2">
<h2>Distributing packages: <a href="https://conda-forge.org/">conda-forge</a></h2>
<p>Popular in scientific computing as arbitrary binaries can be hosted, including compilers (e.g., <code>gcc</code>, Fortran) and even the <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#conda-installation">full NVIDIA CUDA stack</a>!</p>
<div class="fragment">
<p>With the change to full binaries only this also requires that specification of the environment being installed is important.</p>
</div>
<div class="fragment">
<p>With sdists and wheels, if there is no compatible wheel available, <code>pip</code> will automatically <strong>fall back</strong> to trying to locally build from the sdist. Can’t do that if there is no matching <code>.conda</code> binary!</p>
</div>
</section></section>
<section>
<section id="versioning" class="title-slide slide level1 center">
<h1>Versioning</h1>

</section>
<section id="semantic-versioning" class="slide level2">
<h2>Semantic Versioning</h2>
<p>Given a version number <code>MAJOR.MINOR.PATCH</code>, increment the:</p>
<ul>
<li class="fragment"><code>MAJOR</code> version when you make incompatible API changes,</li>
<li class="fragment"><code>MINOR</code> version when you add functionality in a backwards-compatible manner, and</li>
<li class="fragment"><code>PATCH</code> version when you make backwards-compatible bug fixes.</li>
</ul>
<div class="fragment">
<p>To start: initial development release starts at 0.0.1, and increment minor version for subsequent releases.</p>
</div>
</section>
<section id="versioning-with-hatch-git" class="slide level2">
<h2>Versioning with <code>hatch</code> &amp; <code>git</code></h2>
<p>We actually already set up our <code>hatch</code> build system to automatically version our package based on <code>git</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource toml fragment number-lines code-with-copy"><code class="sourceCode toml"><span id="cb22-1"><a></a><span class="kw">[tool.hatch.version]</span></span>
<span id="cb22-2"><a></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"vcs"</span></span>
<span id="cb22-3"><a></a></span>
<span id="cb22-4"><a></a><span class="kw">[tool.hatch.version.raw-options]</span></span>
<span id="cb22-5"><a></a><span class="dt">local_scheme</span> <span class="op">=</span> <span class="st">"no-local-version"</span></span>
<span id="cb22-6"><a></a><span class="co"># Need to give root as we aren't at the same level as the git repo</span></span>
<span id="cb22-7"><a></a><span class="dt">root</span> <span class="op">=</span> <span class="st">".."</span></span>
<span id="cb22-8"><a></a></span>
<span id="cb22-9"><a></a><span class="kw">[tool.hatch.build.hooks.vcs]</span></span>
<span id="cb22-10"><a></a><span class="dt">version-file</span> <span class="op">=</span> <span class="st">"src/rosen/_version.py"</span></span>
<span id="cb22-11"><a></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>This tells <code>hatch</code> to look at the latest <code>git</code> tag and use that as the version number, stored in the automatically generated file <code>src/rosen/_version.py</code>.</p>
</div>
</section>
<section id="versioning-with-hatch-git-1" class="slide level2">
<h2>Versioning with <code>hatch</code> &amp; <code>git</code></h2>
<p>To document a new version, simply create a new <code>git</code> tag:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource bash fragment number-lines code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a></a><span class="ex">$</span> git tag v0.x.y <span class="at">-m</span> <span class="st">"version 0.x.y"</span></span>
<span id="cb23-2"><a></a><span class="ex">$</span> git push <span class="at">--tags</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>This will automatically update the version number in <code>src/rosen/_version.py</code> when next building the package.</p>
</div>
</section>
<section id="good-idea-keep-a-changelog" class="slide level2 smaller">
<h2>Good idea: keep a <code>CHANGELOG</code></h2>
<p>Use a <a href="https://keepachangelog.com/"><code>CHANGELOG</code></a> file to document changes in your package over time.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource markdown fragment number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a></a><span class="fu"># Changelog</span></span>
<span id="cb24-2"><a></a>All notable changes to this project will be documented in this file.</span>
<span id="cb24-3"><a></a></span>
<span id="cb24-4"><a></a>The format is based on <span class="co">[</span><span class="ot">Keep a Changelog</span><span class="co">](http://keepachangelog.com/en/1.0.0/)</span></span>
<span id="cb24-5"><a></a>and this project adheres to <span class="co">[</span><span class="ot">Semantic Versioning</span><span class="co">](http://semver.org/spec/v2.0.0.html)</span>.</span>
<span id="cb24-6"><a></a></span>
<span id="cb24-7"><a></a><span class="fu">## [Unreleased]</span></span>
<span id="cb24-8"><a></a></span>
<span id="cb24-9"><a></a><span class="fu">## [0.0.2] - 2014-07-10</span></span>
<span id="cb24-10"><a></a><span class="fu">### Added</span></span>
<span id="cb24-11"><a></a><span class="ss">- </span>Explanation of the recommended reverse chronological release ordering.</span>
<span id="cb24-12"><a></a></span>
<span id="cb24-13"><a></a><span class="fu">## 0.0.1 - 2014-05-31</span></span>
<span id="cb24-14"><a></a><span class="fu">### Added</span></span>
<span id="cb24-15"><a></a><span class="ss">- </span>This CHANGELOG file to hopefully serve as an evolving example of a</span>
<span id="cb24-16"><a></a>  standardized open source project CHANGELOG.</span>
<span id="cb24-17"><a></a><span class="ss">- </span>CNAME file to enable GitHub Pages custom domain</span>
<span id="cb24-18"><a></a><span class="ss">- </span>README now contains answers to common questions about CHANGELOGs</span>
<span id="cb24-19"><a></a><span class="ss">- </span>Good examples and basic guidelines, including proper date formatting.</span>
<span id="cb24-20"><a></a><span class="ss">- </span>Counter-examples: "What makes unicorns cry?"</span>
<span id="cb24-21"><a></a></span>
<span id="cb24-22"><a></a><span class="ot">[Unreleased]: https://github.com/olivierlacan/keep-a-changelog/compare/v0.0.2...HEAD</span></span>
<span id="cb24-23"><a></a><span class="ot">[0.0.2]: https://github.com/olivierlacan/keep-a-changelog/compare/v0.0.1...v0.0.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section id="takeaways" class="title-slide slide level1 center">
<h1>Takeaways</h1>
<ul>
<li class="fragment">Packaging your code is a good idea</li>
<li class="fragment">Packaging and distributing your code is pretty easy</li>
<li class="fragment">Later, we’ll see how continuous integration can help automate this process</li>
</ul>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/SoftwareDevEngResearch\.github\.io\/software-development-research\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>