<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kyle Niemeyer">
<meta name="dcterms.date" content="2025-01-29">

<title>Packaging and distributing your Python code – Software Development for Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c876a691e515c62f1ddaad8d15b85ab7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./packaging-distribution.html">Packaging and distributing your Python code</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Software Development for Research</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./managing-environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing your computational environment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to version control with Git</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./remote-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Remote version control with Git</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classes-objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brief intro to object-oriented programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./files-command-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to files and command-line inputs in Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packaging-distribution.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Packaging and distributing your Python code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-continuous-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing and continuous integration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Documentation</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#notebook-to-installable-package" id="toc-notebook-to-installable-package" class="nav-link active" data-scroll-target="#notebook-to-installable-package">Notebook to installable package</a>
  <ul class="collapse">
  <li><a href="#hypothetical-workflow-for-a-researcher" id="toc-hypothetical-workflow-for-a-researcher" class="nav-link" data-scroll-target="#hypothetical-workflow-for-a-researcher">Hypothetical workflow for a researcher</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#reusable-science-step-by-step" id="toc-reusable-science-step-by-step" class="nav-link" data-scroll-target="#reusable-science-step-by-step">Reusable science, step by step</a></li>
  <li><a href="#reusable-science-step-by-step-1" id="toc-reusable-science-step-by-step-1" class="nav-link" data-scroll-target="#reusable-science-step-by-step-1">Reusable science, step by step</a></li>
  <li><a href="#reusable-science-step-by-step-2" id="toc-reusable-science-step-by-step-2" class="nav-link" data-scroll-target="#reusable-science-step-by-step-2">Reusable science, step by step</a></li>
  </ul></li>
  <li><a href="#fundamentals" id="toc-fundamentals" class="nav-link" data-scroll-target="#fundamentals">Fundamentals</a>
  <ul class="collapse">
  <li><a href="#what-is-a-python-package" id="toc-what-is-a-python-package" class="nav-link" data-scroll-target="#what-is-a-python-package">What is a Python <em>package</em>?</a></li>
  <li><a href="#what-is-a-python-package-1" id="toc-what-is-a-python-package-1" class="nav-link" data-scroll-target="#what-is-a-python-package-1">What is a Python <em>package</em>?</a></li>
  <li><a href="#aside-why-does-python-have-modules" id="toc-aside-why-does-python-have-modules" class="nav-link" data-scroll-target="#aside-why-does-python-have-modules">Aside: why does Python have modules?</a></li>
  <li><a href="#where-do-modules-come-from" id="toc-where-do-modules-come-from" class="nav-link" data-scroll-target="#where-do-modules-come-from">Where do modules come from?</a></li>
  <li><a href="#what-is-a-python-package-2" id="toc-what-is-a-python-package-2" class="nav-link" data-scroll-target="#what-is-a-python-package-2">What is a Python <em>package</em>?</a></li>
  <li><a href="#package-can-have-multiple-meanings" id="toc-package-can-have-multiple-meanings" class="nav-link" data-scroll-target="#package-can-have-multiple-meanings">“Package” can have multiple meanings!</a></li>
  <li><a href="#when-should-i-turn-my-code-into-a-package" id="toc-when-should-i-turn-my-code-into-a-package" class="nav-link" data-scroll-target="#when-should-i-turn-my-code-into-a-package">When should I turn my code into a package?</a></li>
  </ul></li>
  <li><a href="#packaging-your-code" id="toc-packaging-your-code" class="nav-link" data-scroll-target="#packaging-your-code">Packaging your code</a>
  <ul class="collapse">
  <li><a href="#next-steps-packaging-your-code" id="toc-next-steps-packaging-your-code" class="nav-link" data-scroll-target="#next-steps-packaging-your-code">Next steps: packaging your code</a></li>
  <li><a href="#next-steps-packaging-your-code-1" id="toc-next-steps-packaging-your-code-1" class="nav-link" data-scroll-target="#next-steps-packaging-your-code-1">Next steps: packaging your code</a></li>
  <li><a href="#next-steps-packaging-your-code-2" id="toc-next-steps-packaging-your-code-2" class="nav-link" data-scroll-target="#next-steps-packaging-your-code-2">Next steps: packaging your code</a></li>
  <li><a href="#next-steps-packaging-your-code-3" id="toc-next-steps-packaging-your-code-3" class="nav-link" data-scroll-target="#next-steps-packaging-your-code-3">Next steps: packaging your code</a></li>
  <li><a href="#simple-packaging-example" id="toc-simple-packaging-example" class="nav-link" data-scroll-target="#simple-packaging-example">Simple packaging example</a></li>
  <li><a href="#simple-packaging-example-pyproject.toml" id="toc-simple-packaging-example-pyproject.toml" class="nav-link" data-scroll-target="#simple-packaging-example-pyproject.toml">Simple packaging example: <code>pyproject.toml</code></a></li>
  <li><a href="#simple-packaging-example-pyproject.toml-1" id="toc-simple-packaging-example-pyproject.toml-1" class="nav-link" data-scroll-target="#simple-packaging-example-pyproject.toml-1">Simple packaging example: <code>pyproject.toml</code></a></li>
  <li><a href="#simple-packaging-example-pyproject.toml-2" id="toc-simple-packaging-example-pyproject.toml-2" class="nav-link" data-scroll-target="#simple-packaging-example-pyproject.toml-2">Simple packaging example: <code>pyproject.toml</code></a></li>
  <li><a href="#simple-packaging-example-pyproject.toml-3" id="toc-simple-packaging-example-pyproject.toml-3" class="nav-link" data-scroll-target="#simple-packaging-example-pyproject.toml-3">Simple packaging example: <code>pyproject.toml</code></a></li>
  <li><a href="#simple-packaging-example-installing-your-code" id="toc-simple-packaging-example-installing-your-code" class="nav-link" data-scroll-target="#simple-packaging-example-installing-your-code">Simple packaging example: Installing your code</a></li>
  <li><a href="#simple-packaging-example-installing-your-code-1" id="toc-simple-packaging-example-installing-your-code-1" class="nav-link" data-scroll-target="#simple-packaging-example-installing-your-code-1">Simple packaging example: Installing your code</a></li>
  <li><a href="#packaging-doesnt-slow-down-development" id="toc-packaging-doesnt-slow-down-development" class="nav-link" data-scroll-target="#packaging-doesnt-slow-down-development">Packaging doesn’t slow down development</a></li>
  <li><a href="#packaging-compiled-extensions" id="toc-packaging-compiled-extensions" class="nav-link" data-scroll-target="#packaging-compiled-extensions">Packaging compiled extensions</a></li>
  <li><a href="#packaging-compiled-extensions-1" id="toc-packaging-compiled-extensions-1" class="nav-link" data-scroll-target="#packaging-compiled-extensions-1">Packaging compiled extensions</a></li>
  <li><a href="#packaging-compiled-extensions-2" id="toc-packaging-compiled-extensions-2" class="nav-link" data-scroll-target="#packaging-compiled-extensions-2">Packaging compiled extensions</a></li>
  <li><a href="#packaging-compiled-extensions-3" id="toc-packaging-compiled-extensions-3" class="nav-link" data-scroll-target="#packaging-compiled-extensions-3">Packaging compiled extensions</a></li>
  <li><a href="#packaging-compiled-extensions-installing" id="toc-packaging-compiled-extensions-installing" class="nav-link" data-scroll-target="#packaging-compiled-extensions-installing">Packaging compiled extensions: Installing</a></li>
  </ul></li>
  <li><a href="#distributing-packages" id="toc-distributing-packages" class="nav-link" data-scroll-target="#distributing-packages">Distributing packages</a>
  <ul class="collapse">
  <li><a href="#going-further-distributing-packages" id="toc-going-further-distributing-packages" class="nav-link" data-scroll-target="#going-further-distributing-packages">Going further: Distributing packages</a></li>
  <li><a href="#going-further-distributing-packages-1" id="toc-going-further-distributing-packages-1" class="nav-link" data-scroll-target="#going-further-distributing-packages-1">Going further: Distributing packages</a></li>
  <li><a href="#going-further-distributing-packages-2" id="toc-going-further-distributing-packages-2" class="nav-link" data-scroll-target="#going-further-distributing-packages-2">Going further: Distributing packages</a></li>
  <li><a href="#going-further-distributing-packages-3" id="toc-going-further-distributing-packages-3" class="nav-link" data-scroll-target="#going-further-distributing-packages-3">Going further: Distributing packages</a></li>
  <li><a href="#distributing-packages-conda-forge" id="toc-distributing-packages-conda-forge" class="nav-link" data-scroll-target="#distributing-packages-conda-forge">Distributing packages: conda-forge</a></li>
  <li><a href="#distributing-packages-conda-forge-1" id="toc-distributing-packages-conda-forge-1" class="nav-link" data-scroll-target="#distributing-packages-conda-forge-1">Distributing packages: conda-forge</a></li>
  </ul></li>
  <li><a href="#versioning" id="toc-versioning" class="nav-link" data-scroll-target="#versioning">Versioning</a>
  <ul class="collapse">
  <li><a href="#semantic-versioning" id="toc-semantic-versioning" class="nav-link" data-scroll-target="#semantic-versioning">Semantic Versioning</a></li>
  <li><a href="#versioning-with-hatch-git" id="toc-versioning-with-hatch-git" class="nav-link" data-scroll-target="#versioning-with-hatch-git">Versioning with <code>hatch</code> &amp; <code>git</code></a></li>
  <li><a href="#versioning-with-hatch-git-1" id="toc-versioning-with-hatch-git-1" class="nav-link" data-scroll-target="#versioning-with-hatch-git-1">Versioning with <code>hatch</code> &amp; <code>git</code></a></li>
  <li><a href="#good-idea-keep-a-changelog" id="toc-good-idea-keep-a-changelog" class="nav-link" data-scroll-target="#good-idea-keep-a-changelog">Good idea: keep a <code>CHANGELOG</code></a></li>
  </ul></li>
  <li><a href="#takeaways" id="toc-takeaways" class="nav-link" data-scroll-target="#takeaways">Takeaways</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="packaging-distribution-revealjs.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Packaging and distributing your Python code</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Kyle Niemeyer </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Oregon State University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="notebook-to-installable-package" class="level1">
<h1>Notebook to installable package</h1>
<section id="hypothetical-workflow-for-a-researcher" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="hypothetical-workflow-for-a-researcher">Hypothetical workflow for a researcher</h2>
<ol type="1">
<li>Work on idea for paper with collaborators</li>
<li>Do exploratory analysis in scripts and Jupyter ecosystem</li>
<li>As research progresses, need to write more-complicated functions and workflows</li>
<li>Code begins to sprawl across multiple directories</li>
<li>Software dependencies begin to become more complicated</li>
<li>The code “works on my machine”, but what about your collaborators?</li>
</ol>
<div class="r-fit-text fragment">
<p><strong>People heroically press forward, but this is painful, and not reusable</strong></p>
</div>
</section>
<section id="section" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section"></h2>
<p>Imagine you start with a Jupyter notebook that looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python fragment code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rosenbrock function</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rosen(x):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""The Rosenbrock function"""</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(<span class="fl">100.0</span> <span class="op">*</span> (x[<span class="dv">1</span>:] <span class="op">-</span> x[:<span class="op">-</span><span class="dv">1</span>] <span class="op">**</span> <span class="fl">2.0</span>) <span class="op">**</span> <span class="fl">2.0</span> <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> x[:<span class="op">-</span><span class="dv">1</span>]) <span class="op">**</span> <span class="fl">2.0</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rosen_der(x):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Gradient of the Rosenbrock function"""</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    xm <span class="op">=</span> x[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    xm_m1 <span class="op">=</span> x[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    xm_p1 <span class="op">=</span> x[<span class="dv">2</span>:]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    der <span class="op">=</span> np.zeros_like(x)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    der[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">200</span> <span class="op">*</span> (xm <span class="op">-</span> xm_m1<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">400</span> <span class="op">*</span> (xm_p1 <span class="op">-</span> xm<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> xm <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> xm)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    der[<span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">400</span> <span class="op">*</span> x[<span class="dv">0</span>] <span class="op">*</span> (x[<span class="dv">1</span>] <span class="op">-</span> x[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> x[<span class="dv">0</span>])</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    der[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">200</span> <span class="op">*</span> (x[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> x[<span class="op">-</span><span class="dv">2</span>] <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> der</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimization of the Rosenbrock function with some initial guess</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>, jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(optimized_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step" class="level2">
<h2 class="anchored" data-anchor-id="reusable-science-step-by-step">Reusable science, step by step</h2>
<p>We can convert our notebook code into a simple importable module an and example calling it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree edit-sys-path </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">edit-sys-path</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> code</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── utils.py</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> example.py</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span> directories, 2 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step-1" class="level2">
<h2 class="anchored" data-anchor-id="reusable-science-step-by-step-1">Reusable science, step by step</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example.py</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make ./code/utils.py visible to sys.path</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sys.path position 1 should be after cwd and before activated virtual environment</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, <span class="bu">str</span>(Path().cwd() <span class="op">/</span> <span class="st">"code"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> rosen, rosen_der</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>, jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(optimized_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reusable-science-step-by-step-2" class="level2">
<h2 class="anchored" data-anchor-id="reusable-science-step-by-step-2">Reusable science, step by step</h2>
<ul>
<li>This is <strong>already better</strong> than having everything in a single massive file!</li>
<li>However, now things are tied to this relative path on your computer:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python fragment code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make ./code/utils.py visible to sys.path</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, <span class="bu">str</span>(Path(<span class="va">__file__</span>).parent <span class="op">/</span> <span class="st">"code"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> rosen, rosen_der</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>and are brittle to refactoring and change; plus, not very portable to others.</p>
</div>
<ul>
<li>But we can do better!</li>
</ul>
</section>
</section>
<section id="fundamentals" class="level1 page-columns page-full">
<h1>Fundamentals</h1>
<section id="what-is-a-python-package" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-python-package">What is a Python <em>package</em>?</h2>
<div class="fragment">
<p>First, let’s define <strong>module</strong>.</p>
</div>
<div class="fragment">
<p>From <a href="https://docs.python.org/3/glossary.html#term-module" class="uri">https://docs.python.org/3/glossary.html#term-module</a>:</p>
</div>
<dl>
<dt><strong>module</strong></dt>
<dd>
An object that serves as an organizational unit of Python code. Modules have a namespace containing arbitrary Python objects. Modules are loaded into Python by the process of <a href="https://docs.python.org/3/glossary.html#term-importing">importing</a>.
</dd>
<dd>
<p>See also <a href="https://docs.python.org/3/glossary.html#term-package">package</a>.</p>
</dd>
</dl>
</section>
<section id="what-is-a-python-package-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-is-a-python-package-1">What is a Python <em>package</em>?</h2>
<p>Deconstructing that definition:</p>
<ul>
<li>When I write <code>import modulename</code> I am loading a module</li>
<li>But we also talk about “importing a package”! This seems to imply a package is a kind of module.</li>
<li>The module can contain “arbitrary Python objects”, which could include other modules.</li>
<li>It’s almost like we need a special name for a “module that can contain other modules”…</li>
<li>When loading a module, its name gets added to the <em>namespace</em>, a collection of currently defined names and objects they reference: <code>numpy.random.default_rng</code></li>
</ul>
</section>
<section id="aside-why-does-python-have-modules" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="aside-why-does-python-have-modules">Aside: why does Python have modules?</h2>
<div class="fragment">
<p>Because it’s good for your code to be <em>modular</em>.</p>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://realpython.com/python-modules-packages/" class="uri">https://realpython.com/python-modules-packages/</a></p>
</div></div></section>
<section id="where-do-modules-come-from" class="level2">
<h2 class="anchored" data-anchor-id="where-do-modules-come-from">Where do modules come from?</h2>
<ul>
<li>The standard library
<ul>
<li>Python code</li>
<li>Compiled C code</li>
</ul></li>
<li>A local file that ends in `.py (confusingly, also called a “module”)</li>
<li>Third-party libraries that you <code>pip install</code> or <code>conda install</code> (i.e., packages)</li>
<li>A local package</li>
</ul>
</section>
<section id="what-is-a-python-package-2" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-python-package-2">What is a Python <em>package</em>?</h2>
<p>We spent all that time defining <strong>module</strong>, now we can define <strong>package</strong>:</p>
<div class="fragment">
<p>From <a href="https://docs.python.org/3/glossary.html#term-package" class="uri">https://docs.python.org/3/glossary.html#term-package</a>:</p>
</div>
<dl>
<dt><strong>package</strong></dt>
<dd>
A Python module which can contain submodules or recursively, subpackages.
</dd>
</dl>
</section>
<section id="package-can-have-multiple-meanings" class="level2">
<h2 class="anchored" data-anchor-id="package-can-have-multiple-meanings">“Package” can have multiple meanings!</h2>
<p><a href="https://packaging.python.org/en/latest/discussions/distribution-package-vs-import-package/">Two main usages</a>:</p>
<ol type="1">
<li>import package: the one we talked about, when you write <code>import packagename</code>. We’ll start by making this.</li>
<li>distribution package: the actual artifact that gets downloaded off the internet and stored somewhere, like when you run <code>pip install package</code>. We’ll make these too.</li>
</ol>
</section>
<section id="when-should-i-turn-my-code-into-a-package" class="level2">
<h2 class="anchored" data-anchor-id="when-should-i-turn-my-code-into-a-package">When should I turn my code into a package?</h2>
<p>Two common cases for research code:</p>
<ol type="1">
<li>Code that goes with a research article; mainly used to reproduce the results, AKA a (computational) project or a research compendium.</li>
<li>A generalized tool or <strong>library</strong> that other researchers can use</li>
</ol>
<div class="fragment">
<p>Not all packages intended to reproduce a paper’s results need the full infrastructure we will discuss (documentation website, continuous integration, etc.).</p>
</div>
</section>
</section>
<section id="packaging-your-code" class="level1">
<h1>Packaging your code</h1>
<section id="next-steps-packaging-your-code" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-packaging-your-code">Next steps: packaging your code</h2>
<ul>
<li>The goal is for your code to be installable, and distributable.</li>
<li>Per the Zen of Python, this should be straightforward, right?</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-c</span> <span class="st">'import this'</span> <span class="kw">|</span> <span class="fu">grep</span> obvious</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">There</span> should be one-- and preferably only one <span class="at">--obvious</span> way to do it.</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Although</span> that way may not be obvious at first unless you<span class="st">'re Dutch.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="next-steps-packaging-your-code-1" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-packaging-your-code-1">Next steps: packaging your code</h2>
<p>Unfortunately, not so much. 😔</p>
<div class="fragment">
<p><a href="https://github.com/scientific-python/cookie"><img src="./images/python-packaging-options.png" class="img-fluid" style="width:60.0%" alt="List of Python packaging options"></a></p>
</div>
<div class="fragment">
<p>You might be asking: Why is there more than one thing?</p>
</div>
</section>
<section id="next-steps-packaging-your-code-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="next-steps-packaging-your-code-2">Next steps: packaging your code</h2>
<p>The <span style="color:blue;">good news</span>: Python packaging has improved dramatically in the last 5 years</p>
<ul>
<li>It has never been easier to just point your package manager to some code locally, or on the internet, and get working Python code installed and running on your machine regardless of operating system or architecture</li>
<li>This is a small miracle!</li>
</ul>
<div class="fragment">
<p>The <span style="color:red;">bad news</span>: Python packaging has expanded dramatically in the last 5 years</p>
</div>
<div class="fragment">
<ul>
<li>By creating standards the PyPA allowed for an ecosystem of packaging backends to be created to tackle various problems (this is good!)</li>
<li>This means that our The Zen of Python expectations are violated and we need to make design choices (hard for beginners)</li>
</ul>
</div>
</section>
<section id="next-steps-packaging-your-code-3" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-packaging-your-code-3">Next steps: packaging your code</h2>
<p>The <span style="color:green;">okay news</span>: You can probably default to the simplest thing.</p>
<ul>
<li>pure Python: Probably <code>hatch</code></li>
<li>compiled extensions: Probably <a href="https://pybind11.readthedocs.io/"><code>setuptools</code> + <code>pybind11</code></a> or <a href="https://scikit-build-core.readthedocs.io/"><code>scikit-build-core</code></a> + <a href="https://github.com/pybind/pybind11"><code>pybind11</code></a></li>
</ul>
<div class="columns">
<div class="fragment column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/"><img src="./images/python-packaging-guide.png" class="img-fluid figure-img" alt="Python Packaging User Guide, Packaging Python Projects Tutorial"></a></p>
<figcaption>Python Packaging User Guide, Packaging Python Projects Tutorial</figcaption>
</figure>
</div>
</div><div class="fragment column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://learn.scientific-python.org/development/guides/packaging-simple/"><img src="./images/scientific-python-guide.png" class="img-fluid figure-img" alt="Scientific Python Library Development Guide"></a></p>
<figcaption>Scientific Python Library Development Guide</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="simple-packaging-example" class="level2">
<h2 class="anchored" data-anchor-id="simple-packaging-example">Simple packaging example</h2>
<p>Modern <a href="https://peps.python.org/pep-0518/">PEP 518</a> compliant build backends just need a single file: <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/"><code>pyproject.toml</code></a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree simple_packaging</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">simple-packaging</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> pyproject.toml</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── rosen</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── __init__.py</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── _version.py</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     └── example.py</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> test_example.py</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span> directories, 7 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="simple-packaging-example-pyproject.toml">Simple packaging example: <code>pyproject.toml</code></h2>
<p>What is <code>.toml?</code></p>
<blockquote class="blockquote">
<p>“TOML aims to be a minimal configuration file format that’s easy to read due to obvious semantics. TOML is designed to map unambiguously to a hash table. TOML should be easy to parse into data structures in a wide variety of languages.” — <a href="https://toml.io/">https://toml.io/</a> (emphasis mine)</p>
</blockquote>
<p>In recent years TOML has seen a rise in popularity for configuration files and lock files. Things that need to be easy to read (humans) and easy to parse (machines).</p>
</section>
<section id="simple-packaging-example-pyproject.toml-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-packaging-example-pyproject.toml-1">Simple packaging example: <code>pyproject.toml</code></h2>
<p>Defining how your project should get <strong>built</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode toml fragment code-with-copy"><code class="sourceCode toml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hatchling&gt;=1.13.0"</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hatch-vcs&gt;=0.3.0"</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml-2" class="level2">
<h2 class="anchored" data-anchor-id="simple-packaging-example-pyproject.toml-2">Simple packaging example: <code>pyproject.toml</code></h2>
<p>Defining project <strong>metadata</strong> and <strong>requirements</strong>/<strong>dependencies</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode toml fragment code-with-copy"><code class="sourceCode toml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"rosen"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dt">dynamic</span> <span class="op">=</span> <span class="op">[</span><span class="st">"version"</span><span class="op">]</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">"Example package for demonstration"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">readme</span> <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{ </span><span class="dt">text</span><span class="op"> =</span> <span class="st">"BSD-3-Clause"</span><span class="op"> }</span>  <span class="co"># SPDX short identifier</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">{ </span><span class="dt">name</span><span class="op"> =</span> <span class="st">"Kyle Niemeyer"</span><span class="op">, </span><span class="dt">email</span><span class="op"> =</span> <span class="st">"kyle.niemeyer@oregonstate.edu"</span><span class="op"> },</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="dt">requires-python</span> <span class="op">=</span> <span class="st">"&gt;=3.8"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scipy&gt;=1.6.0"</span><span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"numpy"</span><span class="op">,</span>  <span class="co"># compatible versions controlled through scipy</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-pyproject.toml-3" class="level2">
<h2 class="anchored" data-anchor-id="simple-packaging-example-pyproject.toml-3">Simple packaging example: <code>pyproject.toml</code></h2>
<p>Configuring <strong>tooling options</strong> and <strong>interactions</strong> with other tools:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode toml fragment code-with-copy"><code class="sourceCode toml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.version]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"vcs"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.version.raw-options]</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="dt">local_scheme</span> <span class="op">=</span> <span class="st">"no-local-version"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to give root as we aren't at the same level as the git repo</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dt">root</span> <span class="op">=</span> <span class="st">".."</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.build.hooks.vcs]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dt">version-file</span> <span class="op">=</span> <span class="st">"src/rosen/_version.py"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-installing-your-code" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="simple-packaging-example-installing-your-code">Simple packaging example: Installing your code</h2>
<p>You can now locally install your package into your Python virtual environment!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd simple_packaging</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> pip wheel</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install .</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> built rosen</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Installing</span> collected packages: rosen</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> installed rosen-0.0.2.dev1</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip show rosen</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> rosen</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Version:</span> 0.0.2.dev1</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Summary:</span> Example package for demonstration</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Home-page:</span> https://github.com/SoftwareDevEngResearch/packaging-examples</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Author:</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Author-email:</span> Kyle Niemeyer <span class="op">&lt;</span>kyle.niemeyer@oregonstate.edu<span class="op">&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="ex">License:</span> BSD-3-Clause</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Location:</span> <span class="pp">***</span>/.venv/lib/python3.13/site-packages</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Requires:</span> numpy, scipy</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Required-by:</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-packaging-example-installing-your-code-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-packaging-example-installing-your-code-1">Simple packaging example: Installing your code</h2>
<p>and use it anywhere</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example.py</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now import our code</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rosen.example <span class="im">import</span> rosen, rosen_der</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.array([<span class="fl">1.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">1.9</span>, <span class="fl">1.2</span>])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(rosen, x0, method<span class="op">=</span><span class="st">"BFGS"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                  jac<span class="op">=</span>rosen_der, options<span class="op">=</span>{<span class="st">"disp"</span>: <span class="va">True</span>})</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>optimized_params <span class="op">=</span> result.x</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># array([1.00000004, 1.0000001 , 1.00000021, 1.00000044, 1.00000092])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-doesnt-slow-down-development" class="level2">
<h2 class="anchored" data-anchor-id="packaging-doesnt-slow-down-development">Packaging doesn’t slow down development</h2>
<p><a href="https://peps.python.org/pep-0518/">PEP 518</a> compliant build backends allow for “<a href="https://pip.pypa.io/en/latest/topics/local-project-installs/#editable-installs">editable installs</a>”</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip install <span class="at">--upgrade</span> <span class="at">--editable</span> .</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip show rosen <span class="kw">|</span> <span class="fu">grep</span> <span class="at">--ignore-case</span> <span class="st">'location'</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Location:</span> <span class="pp">***</span>/lib/python3.12/site-packages</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Editable</span> project location: <span class="pp">***</span>/examples/simple_packaging</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Editable installs add the files in the development directory to Python’s import path. (Only need to re-installation if you change the project metadata.)</p>
</div>
<div class="fragment">
<p>Can <strong>develop</strong> your code under <code>src/</code> and have <strong>immediate</strong> access to it.</p>
</div>
</section>
<section id="packaging-compiled-extensions" class="level2">
<h2 class="anchored" data-anchor-id="packaging-compiled-extensions">Packaging compiled extensions</h2>
<p>With modern packaging infrastructure, packaging compiled extensions requires small extra work!</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree compiled_packaging</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">compiled-packaging</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> CMakeLists.txt</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> pyproject.toml</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> ├── basic_math.cpp</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── rosen_cpp</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── __init__.py</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     └── example.py</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> test_example.py</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span> directories, 8 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-1" class="level2">
<h2 class="anchored" data-anchor-id="packaging-compiled-extensions-1">Packaging compiled extensions</h2>
<p>In <code>pyproject.toml</code>:</p>
<p>Swap build system to <a href="https://scikit-build-core.readthedocs.io/"><code>scikit-build-core</code></a> + <a href="https://github.com/pybind/pybind11"><code>pybind11</code></a></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode toml fragment code-with-copy"><code class="sourceCode toml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scikit-build-core"</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pybind11"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">]</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"scikit_build_core.build"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-2" class="level2">
<h2 class="anchored" data-anchor-id="packaging-compiled-extensions-2">Packaging compiled extensions</h2>
<p><a href="https://cliutils.gitlab.io/modern-cmake/"><code>CMakeLists.txt</code></a>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cmake fragment code-with-copy"><code class="sourceCode cmake"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify CMake version and project language</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">cmake_minimum_required</span>(<span class="ot">VERSION</span> <span class="dt">3.15</span>...<span class="dt">3.30</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">project</span>(<span class="dv">${SKBUILD_PROJECT_NAME}</span> <span class="ot">LANGUAGES</span> <span class="ot">CXX</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup pybind11</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(PYBIND11_FINDPYTHON <span class="ot">ON</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">find_package</span>(pybind11 <span class="ot">CONFIG</span> <span class="ot">REQUIRED</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the pybind11 module to build targets</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pybind11_add_module</span>(basic_math MODULE src/basic_math.cpp)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="kw">install</span>(<span class="ot">TARGETS</span> <span class="bn">basic_math</span> <span class="ot">DESTINATION</span> <span class="dv">${SKBUILD_PROJECT_NAME}</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-3" class="level2">
<h2 class="anchored" data-anchor-id="packaging-compiled-extensions-3">Packaging compiled extensions</h2>
<p><code>src/basic_math.cpp</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp fragment code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pybind11/pybind11.h&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> j<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">+</span> j<span class="op">;</span> <span class="op">}</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> py <span class="op">=</span> pybind11<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>PYBIND11_MODULE<span class="op">(</span>basic_math<span class="op">,</span> m<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  m<span class="op">.</span>def<span class="op">(</span><span class="st">"add"</span><span class="op">,</span> <span class="op">&amp;</span>add<span class="op">,</span> <span class="st">R"pbdoc(</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      Add two numbers</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="st">)pbdoc"</span><span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packaging-compiled-extensions-installing" class="level2">
<h2 class="anchored" data-anchor-id="packaging-compiled-extensions-installing">Packaging compiled extensions: Installing</h2>
<p>Installing locally is the same as for the pure-Python example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd simple_packaging</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> pip wheel</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install .</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> built rosen-cpp</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Installing</span> collected packages: rosen-cpp</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> installed rosen-cpp-0.0.1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Module name is that given in C++:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python fragment code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rosen_cpp <span class="im">import</span> basic_math</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>basic_math.add(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="distributing-packages" class="level1">
<h1>Distributing packages</h1>
<section id="going-further-distributing-packages" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="going-further-distributing-packages">Going further: Distributing packages</h2>
<p>If your code is publicly available on the WWW in a Git repository, you’ve already done a version of distribution!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pip install "git+https://example.com/repo/project.git@branch#subdirectory=path"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="dt">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"git+https://github.com/SoftwareDevEngResearch/packaging-examples.git#subdirectory=simple_packaging"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Works for pure-Python packages</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> <span class="st">"git+https://github.com/scikit-hep/pyhf.git"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># as well as packages with compiled extensions</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> <span class="st">"git+https://github.com/scikit-hep/iminuit.git"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-further-distributing-packages-1" class="level2">
<h2 class="anchored" data-anchor-id="going-further-distributing-packages-1">Going further: Distributing packages</h2>
<p>Ideally, we’d prefer a more organized approach: distribution through a <strong>package index</strong>.</p>
<div class="fragment">
<p>First, we need to create <strong>distributions</strong> of our packaged code.</p>
</div>
<div class="fragment">
<p>Distributions that <code>pip</code> can install:</p>
<ul>
<li><a href="https://packaging.python.org/en/latest/glossary/#term-Source-Distribution-or-sdist">source distribution (sdist)</a>: A tarfile (<code>.tar.gz</code>) of the source files of our package (subset of all the files in the repository)</li>
<li><a href="https://packaging.python.org/en/latest/glossary/#term-Built-Distribution">wheel</a>: A zipfile (<code>.whl</code>) of the file system structure and package metadata with any dependencies prebuilt. No arbitrary code execution, only decompressing and copying of files</li>
</ul>
</div>
</section>
<section id="going-further-distributing-packages-2" class="level2">
<h2 class="anchored" data-anchor-id="going-further-distributing-packages-2">Going further: Distributing packages</h2>
<p>To create these <strong>distributions</strong> from source code, rely on our package <strong>build backend</strong> (e.g., <a href="https://hatch.pypa.io/"><code>hatchling</code></a>) and <strong>build frontend</strong> tool like <a href="https://pypa-build.readthedocs.io/en/stable/"><code>build</code></a></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> build</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> build .</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Creating venv isolated environment...</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Installing packages in isolated environment... <span class="er">(</span><span class="ex">hatch-vcs</span><span class="op">&gt;</span>=0.3.0, hatchling<span class="op">&gt;</span>=1.13.0<span class="kw">)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Getting build dependencies for sdist...</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Building sdist...</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Building wheel from sdist</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Creating venv isolated environment...</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Installing packages in isolated environment... <span class="er">(</span><span class="ex">hatch-vcs</span><span class="op">&gt;</span>=0.3.0, hatchling<span class="op">&gt;</span>=1.13.0<span class="kw">)</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Getting build dependencies for wheel...</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Building wheel...</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> built rosen-0.0.1.tar.gz and rosen-0.0.1-py3-none-any.whl</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls dist</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="ex">rosen-0.0.1-py3-none-any.whl</span>  rosen-0.0.1.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-further-distributing-packages-3" class="level2">
<h2 class="anchored" data-anchor-id="going-further-distributing-packages-3">Going further: Distributing packages</h2>
<p>We can now securely upload the distributions under <code>./dist/</code> to any package index that understands how to use them.</p>
<div class="fragment">
<p>The most common is the <a href="https://pypi.org">Python Package Index (PyPI)</a>, which serves as the default package index for <code>pip</code>.</p>
<p><a href="https://pypi.org/"><img src="./images/pypi-page.png" class="img-fluid" style="width:50.0%" alt="PyPI landing page"></a></p>
</div>
</section>
<section id="distributing-packages-conda-forge" class="level2">
<h2 class="anchored" data-anchor-id="distributing-packages-conda-forge">Distributing packages: <a href="https://conda-forge.org/">conda-forge</a></h2>
<p>The conda family of package managers (<a href="https://docs.conda.io/"><code>conda</code></a>, <a href="https://mamba.readthedocs.io/"><code>mamba</code></a>, <a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html"><code>micromamba</code></a>, <a href="https://prefix.dev/docs/pixi/overview"><code>pixi</code></a>) take an alternative approach from <code>pip</code>.</p>
<div class="fragment">
<p>Instead of installing Python packages, they act as general purpose package managers and install <strong>all dependencies</strong> (including Python) as OS and architecture specific <strong>built binaries</strong> (.<code>conda</code> files — <code>zip</code>file containing compressed <code>tar</code> files) hosted on conda-forge.</p>
</div>
<div class="fragment">
<p>This allows an additional level of runtime environment specification not possible with just <code>pip</code>, though getting environment solves right can become more complicated.</p>
</div>
</section>
<section id="distributing-packages-conda-forge-1" class="level2">
<h2 class="anchored" data-anchor-id="distributing-packages-conda-forge-1">Distributing packages: <a href="https://conda-forge.org/">conda-forge</a></h2>
<p>Popular in scientific computing as arbitrary binaries can be hosted, including compilers (e.g., <code>gcc</code>, Fortran) and even the <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#conda-installation">full NVIDIA CUDA stack</a>!</p>
<div class="fragment">
<p>With the change to full binaries only this also requires that specification of the environment being installed is important.</p>
</div>
<div class="fragment">
<p>With sdists and wheels, if there is no compatible wheel available, <code>pip</code> will automatically <strong>fall back</strong> to trying to locally build from the sdist. Can’t do that if there is no matching <code>.conda</code> binary!</p>
</div>
</section>
</section>
<section id="versioning" class="level1">
<h1>Versioning</h1>
<section id="semantic-versioning" class="level2">
<h2 class="anchored" data-anchor-id="semantic-versioning">Semantic Versioning</h2>
<p>Given a version number <code>MAJOR.MINOR.PATCH</code>, increment the:</p>
<ul>
<li><code>MAJOR</code> version when you make incompatible API changes,</li>
<li><code>MINOR</code> version when you add functionality in a backwards-compatible manner, and</li>
<li><code>PATCH</code> version when you make backwards-compatible bug fixes.</li>
</ul>
<div class="fragment">
<p>To start: initial development release starts at 0.0.1, and increment minor version for subsequent releases.</p>
</div>
</section>
<section id="versioning-with-hatch-git" class="level2">
<h2 class="anchored" data-anchor-id="versioning-with-hatch-git">Versioning with <code>hatch</code> &amp; <code>git</code></h2>
<p>We actually already set up our <code>hatch</code> build system to automatically version our package based on <code>git</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode toml fragment code-with-copy"><code class="sourceCode toml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.version]</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"vcs"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.version.raw-options]</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">local_scheme</span> <span class="op">=</span> <span class="st">"no-local-version"</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to give root as we aren't at the same level as the git repo</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dt">root</span> <span class="op">=</span> <span class="st">".."</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.hatch.build.hooks.vcs]</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dt">version-file</span> <span class="op">=</span> <span class="st">"src/rosen/_version.py"</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="dt">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>This tells <code>hatch</code> to look at the latest <code>git</code> tag and use that as the version number, stored in the automatically generated file <code>src/rosen/_version.py</code>.</p>
</div>
</section>
<section id="versioning-with-hatch-git-1" class="level2">
<h2 class="anchored" data-anchor-id="versioning-with-hatch-git-1">Versioning with <code>hatch</code> &amp; <code>git</code></h2>
<p>To document a new version, simply create a new <code>git</code> tag:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash fragment code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git tag v0.x.y <span class="at">-m</span> <span class="st">"version 0.x.y"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git push <span class="at">--tags</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>This will automatically update the version number in <code>src/rosen/_version.py</code> when next building the package.</p>
</div>
</section>
<section id="good-idea-keep-a-changelog" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="good-idea-keep-a-changelog">Good idea: keep a <code>CHANGELOG</code></h2>
<p>Use a <a href="https://keepachangelog.com/"><code>CHANGELOG</code></a> file to document changes in your package over time.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode markdown fragment code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Changelog</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>All notable changes to this project will be documented in this file.</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>The format is based on <span class="co">[</span><span class="ot">Keep a Changelog</span><span class="co">](http://keepachangelog.com/en/1.0.0/)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>and this project adheres to <span class="co">[</span><span class="ot">Semantic Versioning</span><span class="co">](http://semver.org/spec/v2.0.0.html)</span>.</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## [Unreleased]</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## [0.0.2] - 2014-07-10</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">### Added</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Explanation of the recommended reverse chronological release ordering.</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## 0.0.1 - 2014-05-31</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="fu">### Added</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This CHANGELOG file to hopefully serve as an evolving example of a</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  standardized open source project CHANGELOG.</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CNAME file to enable GitHub Pages custom domain</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>README now contains answers to common questions about CHANGELOGs</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Good examples and basic guidelines, including proper date formatting.</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Counter-examples: "What makes unicorns cry?"</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="ot">[Unreleased]: https://github.com/olivierlacan/keep-a-changelog/compare/v0.0.2...HEAD</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="ot">[0.0.2]: https://github.com/olivierlacan/keep-a-changelog/compare/v0.0.1...v0.0.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="takeaways" class="level1">
<h1>Takeaways</h1>
<ul>
<li>Packaging your code is a good idea</li>
<li>Packaging and distributing your code is pretty easy</li>
<li>Later, we’ll see how continuous integration can help automate this process</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/SoftwareDevEngResearch\.github\.io\/software-development-research\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>